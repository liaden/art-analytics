%svg

- content_for :sidebar do
  .nav-item
    %h4 Customize Graph

  = simple_form_for(@controls, url: events_charts_path, wrapper: 'vertical_form', html: {novalidate: true}) do |f|
    .form-group.nav-item.my-0.py-0
      -# TODO: label_icon isn't working on select

      = f.input :metric,
          label_icon: 'ruler',
          include_blank: false,
          input_html: { class: 'custom-select' },
          collection: EventChartControls::METRIC_OPTIONS

    .form-group.nav-item.my-0.py-0
      = f.input :grouping,
          label_icon: 'layer-group',
          as: :toggle_collection

    .form-group.nav-item.my-0.py-0
      = f.input :ordering,
          label_icon: 'sort',
          as: :toggle_collection

    .form-group.nav-item.my-0.py-0
      = f.input :date_after,
        label_icon: 'step-backward',
        as: :tempus_dominus

      = f.input :date_before,
        label_icon: 'step-forward',
        as: :tempus_dominus

    .form-group.nav-item.my-0.py-0
      = f.submit 'Refresh', class: 'btn btn-primary'


:javascript
   var chart;
   nv.addGraph(function() {
       chart = nv.models.multiBarChart()
           .x(function(d) { return d.label; })
           .y(function(d) { return +d.value; })
           .duration(300)
           .margin({bottom: 100, left: 70})
           .rotateLabels(45)
           .groupSpacing(0.1)
       ;
       chart.reduceXTicks(false).staggerLabels(true);
       chart.xAxis
           .axisLabel("Days of the Week")
           .axisLabelDistance(35)
           .showMaxMin(false)
       ;
       chart.yAxis
           .axisLabel("Revenue")
           .axisLabelDistance(-5)
           .tickFormat(d3.format(',.01f'))
       ;
       chart.dispatch.on('renderEnd', function(){
           nv.log('Render Complete');
       });
       d3.select('#chart svg')
           .datum(gon.data)
           .call(chart);
       nv.utils.windowResize(chart.update);
       return chart;
   });
